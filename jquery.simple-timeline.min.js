(function(b){b.simpleTimeline=function(a){a=b.extend({dataTable:null,yearFrom:null,yearTo:null,startZIndex:100,dayRe:/^(\d+)/,monthRe:/\.(\d+)/,yearRe:/(\d+)$/,withIcon:!1,saveTable:!1,actClass:"act",crossWidth:10,crossTop:16},a||{});a.dataTable&&b(a.dataTable).each(function(){var n=b(this),o=a.startZIndex,d=0,g=0,y=a.withIcon?1:0,z=a.withIcon?2:1,e={},p=[],c=0,s=0,t=0,q="",j;b("tr",this).each(function(){var f=b("td",this),k=f.eq(y).text(),A=f.eq(z).html(),f=a.withIcon?f.eq(0).text():"";c++;e[c]=
{date:k,desc:A,className:f,day:k.match(a.dayRe)?parseInt(RegExp.$1,10):0,month:k.match(a.monthRe)?parseInt(RegExp.$1,10):0,year:k.match(a.yearRe)?parseInt(RegExp.$1,10):0};j=1E4*e[c].year+100*e[c].month+e[c].day;j>t&&(t=j,q=k,s=c);p.push([c,j]);d=d?Math.min(e[c].year,d):e[c].year;g=g?Math.max(e[c].year,g):e[c].year});p.sort(function(a,b){return a[1]>b[1]?1:a[1]<b[1]?-1:0});d=a.yearFrom||d;g=a.yearTo||g;if(d&&g){for(var r=d,l=[],u=[],h,i,v=100/(g-d+1);r<=g;r++)l.push('<th style="width:${width}%">${year}</th>'.replace("${width}",
v).replace("${year}",r)),u.push('<td style="width:${width}%"><div></div></td>'.replace("${width}",v));h='<table class="timeline"><thead><tr>${years}</tr></thead><tbody><tr>${points}</tr></tbody></table>'.replace("${years}",l.join("")).replace("${points}",u.join(""));h=b(h);l=b("td div",h);i='<div class="timeline_viewer"><em class="event_date">${date}</em><p class="event_content">${desc}</p></div>'.replace("${date}",q).replace("${desc}",e[s].desc);i=b(i);h.insertBefore(n).click(function(f){var f=b(f.target),
c=f.text(),d=null;if(f.is("a"))return d=b('<div class="timeline_viewer"><em class="event_date">${date}</em><p class="event_content">${desc}</p></div>'.replace("${date}",e[c].date).replace("${desc}",e[c].desc)),i.replaceWith(d),i=d.css("opacity",0.1).fadeTo(300,1),b("a",h).removeClass(a.actClass),f.addClass(a.actClass),!1});i.insertBefore(n);n.toggle(a.saveTable);var B=h.width()/l.length,w=0,x=0,m=0;b.each(p,function(c,g){if((index=g[0])&&(point=e[index])&&point.day&&point.month&&point.year){point.nDay=
(new Date(point.year,point.month-1,point.day)).getTime()-(new Date(point.year,0,0)).getTime();point.nDay=Math.round(point.nDay/864E5);point.left=100*point.nDay/365;var h=o,i=point.year-d,j=B*point.left/100;m=w==i&&j-x<a.crossWidth?m+a.crossTop:0;itemLink=b('<a href="#">'+index+"</a>").addClass(a.withIcon?point.className:"").addClass(point.date==q?a.actClass:"").attr("title",b("<div/>").html(point.desc).text()).css({left:point.left+"%",zIndex:h}).hover(function(){this.style.zIndex=o},function(){this.style.zIndex=
h}).appendTo(l.eq(i));m&&itemLink.css("top",parseInt(itemLink.css("top"))+m);o++;w=i;x=j}})}})}})(jQuery);