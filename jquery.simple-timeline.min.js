(function(c){c.simpleTimeline=function(b){b=c.extend({dataTable:null,yearFrom:null,yearTo:null,expandAll:!1,expandAllText:"Expand all|Hide all",startZIndex:100,dayRe:/^(\d+)/,monthRe:/\.(\d+)/,yearRe:/(\d+)$/,withIcon:!1,saveTable:!1,actClass:"act",crossWidth:10,crossTop:16},b||{});b.dataTable&&c(b.dataTable).each(function(){var m=c(this),j=null,o=null,p=b.startZIndex,g=0,f=0,A=b.withIcon?1:0,B=b.withIcon?2:1,h={},q=[],d=0,u=0,v="",i;c("tr",this).each(function(){var a=c("td",this),k=a.eq(A).text(),
e=a.eq(B).html(),a=b.withIcon?a.eq(0).text():"";d++;h[d]={date:k,desc:e,className:a,day:k.match(b.dayRe)?parseInt(RegExp.$1,10):0,month:k.match(b.monthRe)?parseInt(RegExp.$1,10):0,year:k.match(b.yearRe)?parseInt(RegExp.$1,10):0};i=1E4*h[d].year+100*h[d].month+h[d].day;i>u&&(u=i,v=k);q.push([d,i]);g=g?Math.min(h[d].year,g):h[d].year;f=f?Math.max(h[d].year,f):h[d].year});q.sort(function(b,a){return b[1]>a[1]?1:b[1]<a[1]?-1:0});g=b.yearFrom||g;f=b.yearTo||f;if(g&&f){for(var r=g,l=[],w=[],e,x=100/(f-
g+1);r<=f;r++)l.push('<th style="width:${width}%">${year}</th>'.replace("${width}",x).replace("${year}",r)),w.push('<td style="width:${width}%"><div></div></td>'.replace("${width}",x));e='<table class="timeline"><thead><tr>${years}</tr></thead><tbody><tr>${points}</tr></tbody></table>'.replace("${years}",l.join("")).replace("${points}",w.join(""));e=c(e);l=c("td div",e);e.insertBefore(m).click(function(a){var a=c(a.target),d=a.text();if(a.is("a"))return j.hide().eq(d-1).show().css("opacity",0.1).fadeTo(300,
1),c("a",e).removeClass(b.actClass),a.addClass(b.actClass),c(e).trigger("point_click"),!1});m.toggle(b.saveTable);var C=e.width()/l.length,y=0,z=0,n=0,s,a,t;c.each(q,function(e,d){if((s=d[0])&&(a=h[s])&&a.day&&a.month&&a.year){a.nDay=(new Date(a.year,a.month-1,a.day)).getTime()-(new Date(a.year,0,0)).getTime();a.nDay=Math.round(a.nDay/864E5);a.left=100*a.nDay/365;a.act=a.date==v;var f=p,i=a.year-g,j=C*a.left/100;n=y==i&&j-z<b.crossWidth?n+b.crossTop:0;t=c('<a href="#">'+s+"</a>").addClass(b.withIcon?
a.className:"").addClass(a.act?b.actClass:"").attr("title",c("<div/>").html(a.desc).text()).css({left:a.left+"%",zIndex:f}).hover(function(){this.style.zIndex=p},function(){this.style.zIndex=f}).appendTo(l.eq(i));n&&t.css("top",parseInt(t.css("top"))+n);p++;y=i;z=j;c('<div class="timeline_viewer"><em class="event_date">${date}</em><p class="event_content">${desc}</p></div>'.replace("${date}",a.date).replace("${desc}",a.desc)).insertBefore(m).toggle(a.act)}});j=m.prevAll(".timeline_viewer");b.expandAll&&
(b.expandAllText=b.expandAllText.split("|"),o=c('<div class="timeline_expand"><a href="#">'+b.expandAllText[0]+"</a></div>").insertAfter(e).find("a").click(function(){b.expandAll=!b.expandAll;j.toggle(!b.expandAll);c("a",e).removeClass(b.actClass);o.html(b.expandAll?b.expandAllText[0]:b.expandAllText[1]);return!1}),c(e).bind("point_click",function(){b.expandAll=!0;o.html(b.expandAll?b.expandAllText[0]:b.expandAllText[1])}))}})}})(jQuery);