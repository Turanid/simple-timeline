(function(c){c.simpleTimeline=function(b){b=c.extend({dataTable:null,yearFrom:null,yearTo:null,expandAll:!1,expandAllText:"Expand all|Hide all",startZIndex:100,dayRe:/^(\d+)/,monthRe:/\.(\d+)/,yearRe:/(\d+)$/,withIcon:!1,saveTable:!1,actClass:"act",crossWidth:10,crossTop:16},b||{});b.dataTable&&c(b.dataTable).each(function(){var m=c(this),j=null,o=b.startZIndex,g=0,f=0,z=b.withIcon?1:0,A=b.withIcon?2:1,h={},p=[],d=0,t=0,u="",i;c("tr",this).each(function(){var a=c("td",this),k=a.eq(z).text(),e=a.eq(A).html(),
a=b.withIcon?a.eq(0).text():"";d++;h[d]={date:k,desc:e,className:a,day:k.match(b.dayRe)?parseInt(RegExp.$1,10):0,month:k.match(b.monthRe)?parseInt(RegExp.$1,10):0,year:k.match(b.yearRe)?parseInt(RegExp.$1,10):0};i=1E4*h[d].year+100*h[d].month+h[d].day;i>t&&(t=i,u=k);p.push([d,i]);g=g?Math.min(h[d].year,g):h[d].year;f=f?Math.max(h[d].year,f):h[d].year});p.sort(function(b,a){return b[1]>a[1]?1:b[1]<a[1]?-1:0});g=b.yearFrom||g;f=b.yearTo||f;if(g&&f){for(var q=g,l=[],v=[],e,w=100/(f-g+1);q<=f;q++)l.push('<th style="width:${width}%">${year}</th>'.replace("${width}",
w).replace("${year}",q)),v.push('<td style="width:${width}%"><div></div></td>'.replace("${width}",w));e='<table class="timeline"><thead><tr>${years}</tr></thead><tbody><tr>${points}</tr></tbody></table>'.replace("${years}",l.join("")).replace("${points}",v.join(""));e=c(e);l=c("td div",e);e.insertBefore(m).click(function(a){var a=c(a.target),d=a.text();if(a.is("a"))return j.hide().eq(d-1).show().css("opacity",0.1).fadeTo(300,1),c("a",e).removeClass(b.actClass),a.addClass(b.actClass),!1});m.toggle(b.saveTable);
var B=e.width()/l.length,x=0,y=0,n=0,r,a,s;c.each(p,function(d,e){if((r=e[0])&&(a=h[r])&&a.day&&a.month&&a.year){a.nDay=(new Date(a.year,a.month-1,a.day)).getTime()-(new Date(a.year,0,0)).getTime();a.nDay=Math.round(a.nDay/864E5);a.left=100*a.nDay/365;a.act=a.date==u;var f=o,i=a.year-g,j=B*a.left/100;n=x==i&&j-y<b.crossWidth?n+b.crossTop:0;s=c('<a href="#">'+r+"</a>").addClass(b.withIcon?a.className:"").addClass(a.act?b.actClass:"").attr("title",c("<div/>").html(a.desc).text()).css({left:a.left+"%",
zIndex:f}).hover(function(){this.style.zIndex=o},function(){this.style.zIndex=f}).appendTo(l.eq(i));n&&s.css("top",parseInt(s.css("top"))+n);o++;x=i;y=j;c('<div class="timeline_viewer"><em class="event_date">${date}</em><p class="event_content">${desc}</p></div>'.replace("${date}",a.date).replace("${desc}",a.desc)).insertBefore(m).toggle(a.act)}});j=m.prevAll(".timeline_viewer");b.expandAll&&(b.expandAllText=b.expandAllText.split("|"),c('<div class="timeline_expand"><a href="#">'+b.expandAllText[0]+
"</a></div>").insertAfter(e).find("a").click(function(){b.expandAll=!b.expandAll;j.toggle(!b.expandAll);c(this).html(b.expandAll?b.expandAllText[0]:b.expandAllText[1]);return!1}))}})}})(jQuery);