(function(c){c.simpleTimeline=function(b){b=c.extend({dataTable:null,yearFrom:null,yearTo:null,expandAll:!1,expandAllText:"Expand all|Hide all",startZIndex:100,dayRe:/^(\d+)/,monthRe:/\.(\d+)/,yearRe:/(\d+)$/,withIcon:!1,saveTable:!1,actClass:"act",crossWidth:10,crossTop:16},b||{});b.dataTable&&c(b.dataTable).each(function(){var j=c(this),p=null,q=c('<div class="events_all"></div>'),r=null,s=b.startZIndex,g=0,f=0,C=b.withIcon?1:0,D=b.withIcon?2:1,h={},t=[],d=0,w=0,x="",i;c("tr",this).each(function(){var a=
c("td",this),k=a.eq(C).text(),e=a.eq(D).html(),a=b.withIcon?a.eq(0).text():"";d++;h[d]={date:k,desc:e,className:a,day:k.match(b.dayRe)?parseInt(RegExp.$1,10):0,month:k.match(b.monthRe)?parseInt(RegExp.$1,10):0,year:k.match(b.yearRe)?parseInt(RegExp.$1,10):0};i=1E4*h[d].year+100*h[d].month+h[d].day;i>w&&(w=i,x=k);t.push([d,i]);g=g?Math.min(h[d].year,g):h[d].year;f=f?Math.max(h[d].year,f):h[d].year});t.sort(function(b,a){return b[1]>a[1]?1:b[1]<a[1]?-1:0});g=b.yearFrom||g;f=b.yearTo||f;if(g&&f){for(var u=
g,l=[],y=[],e,z=100/(f-g+1);u<=f;u++)l.push('<th style="width:${width}%">${year}</th>'.replace("${width}",z).replace("${year}",u)),y.push('<td style="width:${width}%"><div></div></td>'.replace("${width}",z));e='<table class="timeline"><thead><tr>${years}</tr></thead><tbody><tr>${points}</tr></tbody></table>'.replace("${years}",l.join("")).replace("${points}",y.join(""));e=c(e);l=c("td div",e);e.insertBefore(j).click(function(a){var a=c(a.target),d=a.text();if(a.is("a"))return p.hide().filter('[data-index="'+
d+'"]').show().css("opacity",0.1).fadeTo(300,1),c("a",e).removeClass(b.actClass),a.addClass(b.actClass),c(e).trigger("point_click"),!1});j.toggle(b.saveTable);var E=e.width()/l.length,A=0,B=0,m=0,n,a,v;q.insertBefore(j);c.each(t,function(e,d){if((n=d[0])&&(a=h[n])&&a.day&&a.month&&a.year){a.nDay=(new Date(a.year,a.month-1,a.day)).getTime()-(new Date(a.year,0,0)).getTime();a.nDay=Math.round(a.nDay/864E5);a.left=100*a.nDay/365;a.act=a.date==x;var f=s,i=a.year-g,j=E*a.left/100;m=A==i&&j-B<b.crossWidth?
m+b.crossTop:0;v=c('<a href="#">'+n+"</a>").addClass(b.withIcon?a.className:"").addClass(a.act?b.actClass:"").attr("title",c("<div/>").html(a.desc).text()).css({left:a.left+"%",zIndex:f}).hover(function(){this.style.zIndex=s},function(){this.style.zIndex=f}).appendTo(l.eq(i));m&&v.css("top",parseInt(v.css("top"))+m);s++;A=i;B=j;c('<div class="timeline_viewer"><em class="event_date">${date}</em><p class="event_content">${desc}</p></div>'.replace("${date}",a.date).replace("${desc}",a.desc)).attr("data-index",
n).appendTo(q).toggle(a.act)}});p=q.find(".timeline_viewer");b.expandAll&&(b.expandAllText=b.expandAllText.split("|"),r=c('<div class="timeline_expand"><a href="#">'+b.expandAllText[0]+"</a></div>").insertAfter(e).find("a").click(function(){b.expandAll=!b.expandAll;p.toggle(!b.expandAll);c("a",e).removeClass(b.actClass);r.html(b.expandAll?b.expandAllText[0]:b.expandAllText[1]);return!1}),c(e).bind("point_click",function(){b.expandAll=!0;r.html(b.expandAll?b.expandAllText[0]:b.expandAllText[1])}))}})}})(jQuery);