(function(c){c.simpleTimeline=function(b){b=c.extend({dataTable:null,yearFrom:null,yearTo:null,expandAll:!1,expandAllText:"Expand all|Hide all",startZIndex:100,dayRe:/^(\d+)/,monthRe:/\.(\d+)/,yearRe:/(\d+)$/,withIcon:!1,saveTable:!1,actClass:"act",crossWidth:10,crossTop:16},b||{});b.dataTable&&c(b.dataTable).each(function(){var j=c(this),n=null,o=c('<div class="events_all"></div>'),p=null,q=b.startZIndex,g=0,f=0,B=b.withIcon?1:0,C=b.withIcon?2:1,h={},r=[],d=0,v=0,w="",i;c("tr",this).each(function(){var a=
c("td",this),k=a.eq(B).text(),e=a.eq(C).html(),a=b.withIcon?a.eq(0).text():"";d++;h[d]={date:k,desc:e,className:a,day:k.match(b.dayRe)?parseInt(RegExp.$1,10):0,month:k.match(b.monthRe)?parseInt(RegExp.$1,10):0,year:k.match(b.yearRe)?parseInt(RegExp.$1,10):0};i=1E4*h[d].year+100*h[d].month+h[d].day;i>v&&(v=i,w=k);r.push([d,i]);g=g?Math.min(h[d].year,g):h[d].year;f=f?Math.max(h[d].year,f):h[d].year});r.sort(function(b,a){return b[1]>a[1]?1:b[1]<a[1]?-1:0});g=b.yearFrom||g;f=b.yearTo||f;if(g&&f){for(var s=
g,l=[],x=[],e,y=100/(f-g+1);s<=f;s++)l.push('<th style="width:${width}%">${year}</th>'.replace("${width}",y).replace("${year}",s)),x.push('<td style="width:${width}%"><div></div></td>'.replace("${width}",y));e='<table class="timeline"><thead><tr>${years}</tr></thead><tbody><tr>${points}</tr></tbody></table>'.replace("${years}",l.join("")).replace("${points}",x.join(""));e=c(e);l=c("td div",e);e.insertBefore(j).click(function(a){var a=c(a.target),d=a.text();if(a.is("a"))return n.hide().eq(d-1).show().css("opacity",
0.1).fadeTo(300,1),c("a",e).removeClass(b.actClass),a.addClass(b.actClass),c(e).trigger("point_click"),!1});j.toggle(b.saveTable);var D=e.width()/l.length,z=0,A=0,m=0,t,a,u;o.insertBefore(j);c.each(r,function(e,d){if((t=d[0])&&(a=h[t])&&a.day&&a.month&&a.year){a.nDay=(new Date(a.year,a.month-1,a.day)).getTime()-(new Date(a.year,0,0)).getTime();a.nDay=Math.round(a.nDay/864E5);a.left=100*a.nDay/365;a.act=a.date==w;var f=q,i=a.year-g,j=D*a.left/100;m=z==i&&j-A<b.crossWidth?m+b.crossTop:0;u=c('<a href="#">'+
t+"</a>").addClass(b.withIcon?a.className:"").addClass(a.act?b.actClass:"").attr("title",c("<div/>").html(a.desc).text()).css({left:a.left+"%",zIndex:f}).hover(function(){this.style.zIndex=q},function(){this.style.zIndex=f}).appendTo(l.eq(i));m&&u.css("top",parseInt(u.css("top"))+m);q++;z=i;A=j;c('<div class="timeline_viewer"><em class="event_date">${date}</em><p class="event_content">${desc}</p></div>'.replace("${date}",a.date).replace("${desc}",a.desc)).appendTo(o).toggle(a.act)}});n=o.find(".timeline_viewer");
b.expandAll&&(b.expandAllText=b.expandAllText.split("|"),p=c('<div class="timeline_expand"><a href="#">'+b.expandAllText[0]+"</a></div>").insertAfter(e).find("a").click(function(){b.expandAll=!b.expandAll;n.toggle(!b.expandAll);c("a",e).removeClass(b.actClass);p.html(b.expandAll?b.expandAllText[0]:b.expandAllText[1]);return!1}),c(e).bind("point_click",function(){b.expandAll=!0;p.html(b.expandAll?b.expandAllText[0]:b.expandAllText[1])}))}})}})(jQuery);